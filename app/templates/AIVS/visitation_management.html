{% extends "home.html" %}

{% block title %} 校外賃居訪視填報 {% endblock %}

{% block heading %}
    <div class="d-sm-flex align-items-center justify-content-between">
        <span class="h3 mb-0 text-gray-800 font-weight-bold">校外賃居訪視填報</span>
    </div>
{% endblock %}

{% block content %}
<style>
    .visitation-form, .visitation-record {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background: #f7f7f7;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .visitation-form h2, .visitation-record h3 {
        margin-bottom: 20px;
    }

    .form-group, .visitation-record p {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
    }

    .form-group input[type="text"],
    .form-group input[type="date"],
    .form-group input[type="radio"] {
        width: calc(100% - 20px);
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .form-group input[type="radio"] {
        width: auto;
    }

    .form-group div, .visitation-record div {
        display: inline-block;
        margin-right: 10px;
    }

    .form-group .btn-primary, .visitation-record .btn-primary {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .form-group .btn-primary:hover, .visitation-record .btn-primary:hover {
        background: #0056b3;
    }

    .visitation-record hr {
        margin: 20px 0;
    }
</style>

<form action="{{ url_for('visitation_management.update') }}" method="post" class="visitation-form">
    <h2>校外賃居資料</h2>
    <div class="form-group">
        <label for="id">學號:</label>
        <input type="text" id="id" name="id" value="{{ current_user.id }}" readonly>
    </div>
    <div class="form-group">
        <label for="semester">學年/學期:</label>
        <input type="text" id="semester" name="semester" placeholder="XXX/X" value="{{ data.semester }}" required>
    </div>
    <div class="form-group">
        <label for="visit_date_time">訪視日期:</label>
        <input type="date" id="visit_date_time" name="visit_date_time" value="{% if data %}{{ data.visit_date_time.strftime('%Y-%m-%d') }}{% endif %}" required>
    </div>
    <div class="form-group">
        <label for="landlord_name">房東姓名:</label>
        <input type="text" id="landlord_name" name="landlord_name" value="{{ data.landlord_name }}" required>
    </div>
    <div class="form-group">
        <label for="landlord_tel">房東電話:</label>
        <input type="text" id="landlord_tel" name="landlord_tel" value="{{ data.landlord_tel }}" required>
    </div>
    <div class="form-group">
        <label for="addr">租賃地址:</label>
        <input type="text" id="addr" name="addr" value="{{ data.addr }}" required>
    </div>
    <div class="form-group">
        <label>租屋型態:</label>
        <div>
            <input type="radio" id="building_type1" name="building_type" value="獨棟透天" {% if data.building_type == '獨棟透天' %} checked {% endif %} required>
            <label for="building_type1">獨棟透天</label>
        </div>
        <div>
            <input type="radio" id="building_type2" name="building_type" value="公寓（五樓以下）" {% if data.building_type == '公寓（五樓以下）' %} checked {% endif %} required>
            <label for="building_type2">公寓（五樓以下）</label>
        </div>
        <div>
            <input type="radio" id="building_type3" name="building_type" value="大樓（六樓以下）" {% if data.building_type == '大樓（六樓以下）' %} checked {% endif %} required>
            <label for="building_type3">大樓（六樓以下）</label>
        </div>
        <div>
            <input type="radio" id="building_type4" name="building_type" value="大型學舍（為學生建設的宿舍）" {% if data.building_type == '大型學舍（為學生建設的宿舍）' %} checked {% endif %} required>
            <label for="building_type4">大型學舍（為學生建設的宿舍）</label>
        </div>
    </div>
    <div class="form-group">
        <label>房間類型:</label>
        <div>
            <input type="radio" id="room_type1" name="room_type" value="套房" {% if data.room_type == '套房' %} checked {% endif %} required>
            <label for="room_type1">套房</label>
        </div>
        <div>
            <input type="radio" id="room_type2" name="room_type" value="雅房" {% if data.room_type == '雅房' %} checked {% endif %} required>
            <label for="room_type2">雅房</label>
        </div>
    </div>
    <div class="form-group">
        <label for="rent">每月租金:</label>
        <input type="text" id="rent" name="rent" value="{{ data.rent }}" required>
    </div>
    <div class="form-group">
        <label for="deposit">押金:</label>
        <input type="text" id="deposit" name="deposit" value="{{ data.deposit }}" required>
    </div>
    <div class="form-group">
        <label>是否值得推薦其他同學租賃:</label>
        <div>
            <input type="radio" id="recommand1" name="recommand" value="1" {% if data.recommand %} checked {% endif %} required>
            <label for="recommand1">是</label>
        </div>
        <div>
            <input type="radio" id="recommand2" name="recommand" value="0" {% if not data.recommand %} checked {% endif %} required>
            <label for="recommand2">否</label>
        </div>
    </div>
    <div class="form-group">
        <input type="submit" value="送出" class="btn btn-primary">
    </div>
</form>

{% if current_user.type == 'administrator' or current_user.type == 'advisor' %}
    {% for item in data %}
        <div class="visitation-record">
            <h3>{{ student_name[data.index(item)] }} - 校外賃居資料</h3>
            <p><strong>學號:</strong> {{ item.id }}</p>
            <p><strong>學年/學期:</strong> {{ item.semester }}</p>
            <p><strong>訪視日期:</strong> {{ item.visit_date_time.strftime('%Y-%m-%d') }}</p>
            <p><strong>房東姓名:</strong> {{ item.landlord_name }}</p>
            <p><strong>房東電話:</strong> {{ item.landlord_tel }}</p>
            <p><strong>租賃地址:</strong> {{ item.addr }}</p>
            <p><strong>租屋型態:</strong> 
                {% if item.building_type == '獨棟透天' %} 獨棟透天
                {% elif item.building_type == '公寓（五樓以下）' %} 公寓（五樓以下）
                {% elif item.building_type == '大樓（六樓以下）' %} 大樓（六樓以下）
                {% elif item.building_type == '大型學舍（為學生建設的宿舍）' %} 大型學舍（為學生建設的宿舍）
                {% endif %}
            </p>
            <p><strong>房間類型:</strong>
                {% if item.room_type == '套房' %} 套房
                {% elif item.room_type == '雅房' %} 雅房
                {% endif %}
            </p>
            <p><strong>每月租金:</strong> {{ item.rent }}</p>
            <p><strong>押金:</strong> {{ item.deposit }}</p>
            <p><strong>是否值得推薦其他同學租賃:</strong> {% if item.recommand %} 是 {% else %} 否 {% endif %}</p>
            <h3>賃居安全自主管理檢視資料</h3>
            {% for i in range(1, 14) %}
                <p><strong>{{ safe_manage_labels[i-1] }}:</strong> {% if attribute(item, 'safe_manage' ~ i) %} 是 {% else %} 否 {% endif %}</p>
            {% endfor %}
            <hr>
        </div>
    {% endfor %}
{% endif %}
{% endblock %}
